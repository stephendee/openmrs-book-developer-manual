
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Architecture Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="dataModel.html" />
    
    
    <link rel="prev" href="../Community/collaborationTools.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Kick_off/brief_background_of_health_it.html">
            
                <a href="../Kick_off/brief_background_of_health_it.html">
            
                    
                    Brief Background of Health IT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Kick_off/solving_the_health_it_challenges_our_responsemd.html">
            
                <a href="../Kick_off/solving_the_health_it_challenges_our_responsemd.html">
            
                    
                    Solving the Health IT Challenges
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Kick_off/openmrs_today.html">
            
                <a href="../Kick_off/openmrs_today.html">
            
                    
                    OpenMRS Today
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Community/workingCooperatively.html">
            
                <a href="../Community/workingCooperatively.html">
            
                    
                    Working Cooperatively
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../Community/collaborationTools.html">
            
                <a href="../Community/collaborationTools.html">
            
                    
                    Collaboration Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="dataModel.html">
            
                <a href="dataModel.html">
            
                    
                    Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="developmentProcess.html">
            
                <a href="developmentProcess.html">
            
                    
                    Development Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="getSetUp.html">
            
                <a href="getSetUp.html">
            
                    
                    Get Set Up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../Case_study/yourFirstModule.html">
            
                <a href="../Case_study/yourFirstModule.html">
            
                    
                    Making Your First Module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../What_next/getInvolved.html">
            
                <a href="../What_next/getInvolved.html">
            
                    
                    Get Involved
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../What_next/getSupport.html">
            
                <a href="../What_next/getSupport.html">
            
                    
                    Get Support
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../What_next/devChecklist.html">
            
                <a href="../What_next/devChecklist.html">
            
                    
                    Developer Checklist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    Appendices
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../Appendices/appendixA.html">
            
                <a href="../Appendices/appendixA.html">
            
                    
                    Appendix A: Learning Resources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../Appendices/appendixB.html">
            
                <a href="../Appendices/appendixB.html">
            
                    
                    Appendix B: OpenMRS Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../Appendices/appendixC.html">
            
                <a href="../Appendices/appendixC.html">
            
                    
                    Appendix C: Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../about.html">
            
                <a href="../about.html">
            
                    
                    About This Book
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Architecture</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><center><h1 id="architecture">Architecture</h1></center></p>
<hr>
<p>This chapter contains an in-depth view of the architecture of the system. If you don&apos;t understand everything on the first reading, don&apos;t fret! Understanding how the basic system fits together is the most important thing you need for now.</p>
<h2 id="technical-overview">Technical Overview</h2>
<p>OpenMRS is a framework built upon Java and other related frameworks. It is based on a modular architecture which consists of a core application and optional modules which provide additional functionality to the core workflows.</p>
<p>The key architectural components of the OpenMRS core can be depicted as follows:</p>
<p><center><img src="../assets/OpenMRS-architecture.png"></center> <em> An Overview of OpenMRS </em></p>
<p>The backbone of OpenMRS lies in its core API. The OpenMRS API has methods for all of the basic functions such as adding/updating a patient, encounter, observation, etc. Methods which enable this functionality are provided in service layer classes. </p>
<h2 id="the-source-code-structure">The Source Code Structure</h2>
<p>In OpenMRS framework and modules, there are different levels in the code architecture. The OpenMRS source code is divided into three main segments: </p>
<ul>
<li>The User Interface (presentation)</li>
<li>The Service Layer</li>
<li>The Data Access layer</li>
</ul>
<p>This layering isolates various system responsibilities from one another, to improve both system development and maintenance.</p>
<h3 id="the-data-access-layer">The Data Access layer</h3>
<p>The Data Access layer is an abstraction layer from the actual data model and its changes. It uses Hibernate as the Object Relational mapping tool, and Liquibase to manage relational database changes in a database-independent way.</p>
<p>The relationships between our domain objects and database tables are mapped using a mixture of Hibernate annotations and XML mapping files. The data access layer is exposed to the service layer through interfaces, thereby shielding it from implementation details such as which object relational mapping tool is being used.</p>
<h3 id="the-service-layer">The Service layer</h3>
<p>The Service layer is responsible for managing the business logic of the application. It is built around the <a href="https://en.wikipedia.org/wiki/Spring_Framework" target="_blank">Spring framework.</a> The OpenMRS service layer classes make extensive use of the Spring framework for a number of tasks including the following: </p>
<ul>
<li>Spring <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming" target="_blank">Aspect Oriented Programming (AOP)</a> is used to provide separate cross cutting functions (for example: authentication, logging).</li>
<li>Spring Dependency Injection (DI) is used to provide dependencies between components.</li>
<li>Spring is used to manage transactions in between service layer classes</li>
</ul>
<h3 id="user-interface-layer">User Interface layer</h3>
<p>The User Interface layer for the legacy application is built upon Spring MVC, Direct Web Remoting (DWR), JSP and JavaScript. DWR is used for AJAX functionality and it provides the mapping between our Java objects and methods to JavaScript objects and methods respectively. JQuery is used to simplify the interactions with Javascript and the browser. Spring MVC is used to provide the Model-View-Controller design pattern. Our domain objects serve as the Model. We have a mixture of controllers that subclass Spring&apos;s <code>SimpleFormControllers</code> and those which use Spring&apos;s <code>@Controller annotation</code>. For the new reference application user interface, we no longer use Spring <code>MVC</code>, <code>DWR</code> or <code>JSP</code>, but heavily use <strong>Groovy, JQuery, AngularJS</strong>, and more.</p>
<h2 id="the-modular-architecture">The Modular Architecture</h2>
<p>At the heart of OpenMRS is a custom module framework which lets you extend and modify the default functionality of the OpenMRS core in accordance to your needs. Modules are also structured like the OpenMRS core, and consist of user interface, data access and service layers.</p>
<p>Some OpenMRS functionality is pulled out into modules instead of being written into the core application. This allows users to upgrade the content in those modules without having to wait for the next OpenMRS release. Currently, the only core module used in OpenMRS is the Logic Module. </p>
<h2 id="associated-frameworks-and-technology-stacks">Associated Frameworks and Technology Stacks</h2>
<h3 id="hibernate">Hibernate</h3>
<p>Hibernate is the object-relational mapping library used by OpenMRS. It allows users to describe the relationship between database tables and domain objects using xml configuration files or Java annotations.</p>
<p>Hibernate is also useful in managing dependencies between classes. As an example, the concept domain in the data model consists of tables named concept, concept_answer, concept_set and concept_name. It would be very difficult to keep up with where to store each part of the concept object and the relations between them if a user decides to update each table individually. However, using Hibernate, developers only need to concern themselves with the Concept object, and not the tables behind that object. The <code>concept.hbm.xml</code> mapping file does the work of knowing that the Concept object contains a collection of <code>ConceptSet objects</code>, a collection of <code>ConceptName objects</code>, etc.</p>
<p>However, also note that Hibernate enforces lazy loading - it will not load all associated objects until they are needed. For this reason, you must either <code>fetch/save/manipulate</code> your object in the same session (between one open/closeSession) or you must hydrate all object collections in the object by calling the <strong>getters</strong> (getConceptAnswers, getConceptNames, getSynonyms, etc).</p>
<h3 id="spring-mvc">Spring MVC</h3>
<p>OpenMRS strongly subscribes to the <a href="https://en.wikipedia.org/wiki/Model&#x2013;view&#x2013;controller" target="_blank">Model-View-Controller</a> pattern. Most controllers included in the OpenMRS core will be <code>SimpleFormControllers</code> and be placed in the <code>org.openmrs.web.controller package</code>. However, some controllers have been rewritten to use Spring 2.5+ annotations, and we recommend that you use these in the future. The model is set up in the controller&apos;s formBackingObject, and processed/saved in the processFormSubmission and onSubmit methods. The <code>jsp</code> views are placed in <code>/web/WEB-INF/view</code>.</p>
<p>Furthermore, not all files served by the webapp are run through Spring. The <code>/web/WEB-INF/web.xml</code> file maps certain web page extensions to the SpringController. All <code>*.form</code>, <code>*.htm</code>, and *<code>.list</code> pages are mapped. The SpringController then uses the mappings in the <code>openmrs-servlet.xml</code> file to know which pages are mapping to which Controller.</p>
<p>There are no <code>jsp</code> pages that are accessed directly. If a page&apos;s url is <code>/admin/patients/index.htm</code>, the jsp will actually reside in <code>/web/WEB-INF/view/admin/patients/index.jsp</code>. This is necessary so that we can do the redirect with the SpringController. Because the file being accessed ends with <code>.htm</code>, the SpringController is invoked by the web server. When the SpringController sees the url, it simply replaces <code>.htm</code> with <code>.jsp</code> and looks for the file in <code>/web/WEB-INF/view/</code> according to the jspViewResolver bean in <code>openmrs-servlet.xml</code>. If the page being accessed was patient.form, the mapping in the urlMapping bean would have told spring to use the PatientFormController and the <code>patientForm.jsp</code> file. </p>
<h3 id="authentication-and-authorization">Authentication and Authorization</h3>
<p>OpenMRS has a very granulated permissions system. Every action is associated with a Privilege, which in turn can be grouped into Roles. Examples of such privileges are &quot;Add Patient&quot;, &quot;Update Patient&quot;, &quot;Delete Patient&quot;, &quot;Add Concept&quot;, &quot;Update Concept&quot;, and more. A Role can also point to a list of inherited roles. The role inherits all privileges from that inherited role. In this way, hierarchies of roles are possible. A User contains only a collection of Roles, not Privileges. These privileges are enforced in the service layer using AOP annotations.</p>
<h3 id="build-management">Build Management</h3>
<p>OpenMRS uses <strong>Apache Maven</strong> for build management of the OpenMRS core and modules. </p>
<p>All information regarding the module being built, its dependencies on other external modules and components, the build order, directories, and required plug-ins are stored in the modules&apos; <code>pom.xml</code> file. </p>
<p>Following release, these build artifacts are uploaded and maintained in a maven repository manager. A maven repository manager is used for this purpose due to a number of advantages that it provides. These advantages include:</p>
<ul>
<li>Faster and more reliable builds</li>
<li>Improved collaboration</li>
<li>Component usage visibility</li>
<li>Enforcement of component standards </li>
<li>The Maven Repository used by OpenMRS is SonaType Nexus, which can be accessed at <a href="http://mavenrepo.openmrs.org/nexus/" target="_blank">http://mavenrepo.openmrs.org/nexus/</a>. </li>
<li>Artifacts maintained in the OpenMRS repository are:</li>
</ul>
<h2 id="releases">Releases</h2>
<ul>
<li>Maven built releases (1.8.0 and later)</li>
<li>Ant built releases (1.5.0 up to 1.7.X)</li>
</ul>
<h4 id="snapshots">Snapshots</h4>
<ul>
<li>Maven development versions</li>
</ul>
<h4 id="modules">Modules</h4>
<ul>
<li>Module releases</li>
</ul>
<h4 id="3rd-party-artifacts">3rd Party Artifacts</h4>
<ul>
<li>Libraries not found in other Maven repositories (HAPI)</li>
<li>Modified libraries (DWR, Hibernate, Liquibase, Simple XML)</li>
<li>Custom Maven plugins (OpenMRS omod plugin)</li>
</ul>
<h2 id="summary">Summary</h2>
<p>As you read the next section, keep in mind the important parts from this chapter:</p>
<ul>
<li>OpenMRS consists of a core system, with a modular architecture to extend its functionality.</li>
<li>There are three main layers to the system: User Interface, Service Layer and Data Access Layer.</li>
<li>OpenMRS makes extensive use of a number of frameworks including Spring and Hibernate.</li>
<li>We use Apache Maven for build management, JIRA for issue management and Github for version control.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../Community/collaborationTools.html" class="navigation navigation-prev " aria-label="Previous page: Collaboration Tools">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="dataModel.html" class="navigation navigation-next " aria-label="Next page: Data Model">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Architecture","level":"1.7","depth":1,"next":{"title":"Data Model","level":"1.8","depth":1,"path":"Technology/dataModel.md","ref":"Technology/dataModel.md","articles":[]},"previous":{"title":"Collaboration Tools","level":"1.6","depth":1,"path":"Community/collaborationTools.md","ref":"Community/collaborationTools.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-default","custom-favicon","ga","edit-link"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"/assets/favicon.ico","custom-favicon":{},"ga":{"configuration":"auto","token":"UA-16695719-13"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"EDIT","base":"https://github.com/openmrs/openmrs-book-developer-manual/edit/master"},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"languages":[{"lang":"js","name":"JavaScript","default":true},{"lang":"java","name":"Java"},{"lang":"html","name":"HTML"},{"lang":"sh","name":"Shell"},{"lang":"go","name":"Go"}]}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"Technology/architecture.md","mtime":"2018-01-15T19:55:19.067Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-01-15T19:56:26.504Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

